#
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Source Prezto.
if [[ -s "${ZDOTDIR:-${HOME}}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-${HOME}}/.zprezto/init.zsh"
fi

# Customize to your needs...

path=(
  ~/.poetry/bin(N-/)
  ~/.local/bin(N-/)
  /usr/local/aws/bin(N-/)
  $path
)

# Set umask explicitly for WSL
umask 022

# Enable bash style completion
autoload -U +X bashcompinit && bashcompinit

# direnv
if (( ${+commands[direnv]} )); then
   eval "$(direnv hook zsh)"
fi

# Pyenv
export PYENV_ROOT="${HOME}/.pyenv"
export PATH="${PYENV_ROOT}/bin:${PATH}"
if (( ${+commands[pyenv]} )); then
  eval "$(pyenv init -)"
fi

# Pipenv
export PIPENV_VENV_IN_PROJECT=true
if (( ${+commands[pipenv]} )); then
  eval "$(pipenv --completion)"
fi

# Nodenv
export NODENV_ROOT="${HOME}/.nodenv"
export PATH="${NODENV_ROOT}/bin:${PATH}"
if (( ${+commands[nodenv]} )); then
  eval "$(nodenv init -)"
fi
if [[ -e /usr/local/opt/nodenv/completions/nodenv.zsh ]]; then
  source /usr/local/opt/nodenv/completions/nodenv.zsh
fi

# Enable completion for awscli
if (( ${+commands[aws_zsh_completer.sh]} )); then
  source "${commands[aws_zsh_completer.sh]}"
fi

# enable completion for terraform
if (( ${+commands[terraform]} )); then
  complete -o nospace -C "${commands[terraform]}" terraform
fi

# proxy configuration
function enable_proxy() {
  if [ -e "${HOME}/.proxyrc" ]; then
    source "${HOME}/.proxyrc"
  fi

  if [ -n "${http_proxy}" ]; then
    git config --global http.proxy "${http_proxy}"
  fi

  if [ -n "${https_proxy}" ]; then
    git config --global https.proxy "${http_proxy}"
  fi
}

enable_proxy

# Aliases
alias vim='nvim'
